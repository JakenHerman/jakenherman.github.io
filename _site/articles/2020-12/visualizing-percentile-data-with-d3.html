<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Recreating Baseball Savant's Percentile Ranking Visualization">
  <meta name="keywords" content="blog, jaken, herman, software, engineer, and data science">
  <meta name="author" content="Visualizing Percentile Data with d3 | Jaken Herman">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">
  
  <script data-ad-client="ca-pub-9580564349953922" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Visualizing Percentile Data with d3 | Jaken Herman">
  <meta name="twitter:description" content="Recreating Baseball Savant&#39;s Percentile Ranking Visualization">
  
    <meta property="twitter:image" content="http://localhost:4000/img/leonids-logo.png">
  

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3">
  <meta property="og:title" content="Visualizing Percentile Data with d3 | Jaken Herman">
  <meta property="og:description" content="Recreating Baseball Savant&#39;s Percentile Ranking Visualization">
  
    <meta property="og:image" content="http://localhost:4000/img/leonids-logo.png">
  
  <title>Visualizing Percentile Data with d3 | Jaken Herman</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">
  
  <!-- FontAwesome -->
  <script src="https://kit.fontawesome.com/12caf75e50.js"></script>

  <link rel="canonical" href="http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3">
  <link rel="alternate" type="application/rss+xml" title="Jaken Herman" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <a aria-label="Jaken Herman Website Link" href="http://localhost:4000/">
    <img src="http://localhost:4000/img/avatar.jpg" alt="An Image of Jaken Herman" class="avatar">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">jaken herman</a>
  <span class="author_job">⚾ Front-End Developer for the Houston Astros ⚾</span>
  <span class="author_bio mbm">husband | baseball fan | author</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a aria-label="Jaken Herman Website Link" href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a aria-label="Navigate to Article - Archive" href="http://localhost:4000/archive/">Archive</a>
      </li>
        
      <li class="nav-item">
        <a aria-label="Navigate to Article - Contact" href="http://localhost:4000/contact/">Contact</a>
      </li>
          
      <li class="nav-item">
        <a aria-label="Navigate to Article - Categories" href="http://localhost:4000/categories/">Categories</a>
      </li>
            
      <li class="nav-item">
        <a aria-label="Navigate to Article - Resume" href="http://localhost:4000/resume/">Resume</a>
      </li>
        
      <li class="nav-item">
        <a aria-label="Navigate to Article - Strava" href="http://localhost:4000/strava/">Strava</a>
      </li>
        
      <li class="nav-item">
        <a aria-label="Navigate to Article - Stream" href="http://localhost:4000/stream/">Stream</a>
      </li>
         
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a aria-label=\"Email Jaken Herman\" class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('jakenherman7@gmail.com', 'Hello from website');</script>
      </li>
    
    <li><a aria-label="Go to Jaken Herman's Twitter Page" rel="noreferrer" href="http://twitter.com/jakenherman" class="social-link-item" target="_blank"><i class="fab fa-twitter"></i></a></li>
    <li><a aria-label="Go to Jaken Herman's TripAdvisor Page" rel="noreferrer" href="https://www.tripadvisor.com/Profile/jakenherman" class="social-link-item" target="_blank"><i class="fab fa-tripadvisor"></i></a></li>
   <!--  -->
    
    
    <li><a aria-label="Go to Jaken Herman's LinkedIn Page" rel="noreferrer" href="http://linkedin.com/in/jakenherman" class="social-link-item" target="_blank"><i class="fab fa-linkedin"></i></a></li>
    <li><a aria-label="Go to Jaken Herman's Yelp Page" rel="noreferrer" href="https://www.yelp.com/user_details?userid=Wu6Cbv_59QNDmNlw02cqMA" class="social-link-item" target="_blank"><i class="fab fa-yelp"></i></a></li>
    <li><a aria-label="Skype with Jaken Herman" rel="noreferrer" href="skype:jaken2711" class="social-link-item" target="_blank"><i class="fab fa-skype"></i></a></li>
    
    <li><a aria-label="Go to Jaken Herman's Instagram Page" rel="noreferrer" href="http://instagram.com/jaken.herman" class="social-link-item" target="_blank"><i class="fab fa-instagram"></i></a></li>
    
    <li><a aria-label="Go to Jaken Herman's GitHub Page" rel="noreferrer" href="http://github.com/JakenHerman" class="social-link-item" target="_blank"><i class="fab fa-github"></i></a></li>
    
    <li><a aria-label="Go to Jaken Herman's StackOverflow Page" rel="noreferrer" href="http://stackoverflow.com/users/2752265/jaken-herman?tab=profile" class="social-link-item" target="_blank"><i class="fab fa-stack-overflow"></i></a></li>
    
    <li><a rel="noreferrer" href="http://dribbble.com/jakenherman" class="social-link-item" target="_blank"><i class="fab fa-dribbble"></i></a></li>
    
    
    
    <li><a aria-label="Go to Jaken Herman's YouTube Channel" rel="noreferrer" href="http://bit.ly/thehermans" class="social-link-item" target="_blank"><i class="fab fa-youtube"></i></a></li>
    
    
    
    
    <li><a rel="noreferrer" href="http://codepen.io/JakenHerman" class="social-link-item" target="_blank"><i class="fab fa-codepen"></i></a></li>
    
    
    <li><a aria-label="Go to Jaken Herman's Amazon Author Page" rel="noreferrer" href="https://amazon.com/author/jakenherman" class="social-link-item" target="_blank"><i class="fab fa-amazon"></i></a></li>
    <li><a aria-label="Go to Jaken Herman's Strava Page" rel="noreferrer" href="https://strava.com/athletes/jaken_herman" class="social-link-item" target="_blank"><i class="fab fa-strava"></i></a>
    </li>
    <li><a aria-label="Go to Jaken Herman's Dev Page" rel="noreferrer" href="https://dev.to/jakenherman" class="social-link-item" target="_blank"><i class="fab fa-dev"></i></a></li>
    <li><a aria-label="Go to Jaken Herman's Untappd Page" rel="noreferrer" href="https://untappd.com/user/JakenH" class="social-link-item" target="_blank"><i class="fab fa-untappd"></i></a></li>
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <a class="btn" href= "http://localhost:4000/" >
  Home
</a>



<div id="post">
  <header class="post-header">
    <h1 title="Visualizing Percentile Data with d3">Visualizing Percentile Data with d3</h1>
    <span class="post-meta">
      <span class="post-date">
        13 DEC 2020
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    9 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <p>On Baseball Savant (<a href="https://baseballsavant.mlb.com">https://baseballsavant.mlb.com</a>), they have these great visualizations for displaying percentile rankings. Basically, out of the population of MLB athletes, where does a player stand in comparison for a given statistic? In the photograph below, I’ve snipped a few stats (Exit Velocity, xBA, K%, and Sprint Speed). We’re going to replicate this visualization using d3 today. (For the record, this is Daniel Vogelbach (MIL) vs. 2020 season data)</p>

<p><img src="http://localhost:4000/img/baseball_savant_percentiles.png" alt="Baseball Savant's Percentile Ranking Visualization" /></p>

<p>First, I’ll assume you have some familiarity with d3 as well as some familiarity with what <em>slight</em> modifications will be necessary between traditional d3 and the code we’re going to write today, which is d3 formatted for Observable (<a href="https://observablehq.com/@jakenherman">https://observablehq.com</a>). Let’s load in d3:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">d3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"d3@5"</span><span class="p">,</span> <span class="s2">"d3-array@2"</span><span class="p">,</span> <span class="s2">"d3-color@2"</span><span class="p">,</span> <span class="s2">"d3-scale-chromatic@2"</span><span class="p">)</span></code></pre></figure>

<iframe width="100%" height="109" frameborder="0" src="https://observablehq.com/embed/@jakenherman/visualizing-percentile-data?cell=d3"></iframe>

<p>Next, we need to set up a helper function to get our cx values. Because the width of our canvas is going to be 150 pixels but percentiles are ranged 0-100, we have to do some calculation for the actual x values:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">getX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">percentile</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">150</span><span class="o">*</span><span class="nx">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Now, let’s add our data. We’re going to format our data as a collection of objects that hold information about the statistic label, the value of the statistic (this will be our cx value, so we’re going to utilize the <code class="highlighter-rouge">getX()</code> function we’ve just written), and the y-value of where the statistic will be displayed:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">percentileData</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">label</span><span class="p">:</span> <span class="s1">'Exit Velocity'</span><span class="p">,</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">63</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>     
  <span class="p">{</span> <span class="na">label</span><span class="p">:</span> <span class="s1">'xBA'</span><span class="p">,</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">29</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">60</span> <span class="p">},</span>     
  <span class="p">{</span> <span class="na">label</span><span class="p">:</span> <span class="s1">'K%'</span><span class="p">,</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">90</span> <span class="p">},</span>     
  <span class="p">{</span> <span class="na">label</span><span class="p">:</span> <span class="s1">'Sprint Speed'</span><span class="p">,</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">120</span> <span class="p">}</span>
<span class="p">];</span></code></pre></figure>

<p>We’re cookin’ with gas, now! Let’s define our SVG:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'svg'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'width'</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'height'</span><span class="p">,</span> <span class="mi">150</span><span class="p">);</span></code></pre></figure>

<p>The first thing we’re going to add to our new <code class="highlighter-rouge">svg</code> is the horizontal lines in which each percentile ranking will be displayed. This is pretty simple to do, because the x1 and x2 values will be 0 - 160 (we just want to go straight across our svg which has a width of 170), and the y1 and y2 values will be the same (and they’re the <code class="highlighter-rouge">cy</code> key in our <code class="highlighter-rouge">percentileData</code> object):</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kr">const</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'line'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">percentileData</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'line'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'stroke'</span><span class="p">,</span> <span class="s1">'rgb(155, 155, 155)'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'stroke-width'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x1'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x2'</span><span class="p">,</span> <span class="mi">160</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y1'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cy</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y2'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cy</span><span class="p">);</span></code></pre></figure>

<p><img src="http://localhost:4000/img/PercentileRankingPost/lines.svg" alt="Lines" /></p>

<p>The horizontal lines are a good start, but they don’t look the same as Baseball Savant’s horizontal lines do… yet! Baseball savant has circular decorators on their lines at the 0, 50, and 100th percentile positions. This makes it easy to identify how far off the measure of center a player is. Let’s add these now:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">lineDecorators</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">60</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">60</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">60</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">90</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">90</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">90</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">120</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">120</span> <span class="p">},</span>     
    <span class="p">{</span> <span class="na">cx</span><span class="p">:</span> <span class="nx">getX</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="na">cy</span><span class="p">:</span> <span class="mi">120</span> <span class="p">}</span>  
  <span class="p">];</span>

 <span class="nx">decorators</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'#decor'</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">lineDecorators</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                   <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'circle'</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'decor'</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'cx'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cx</span> <span class="o">+</span> <span class="mi">10</span> <span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'cy'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cy</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'r'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span> <span class="s1">'rgb(155, 155, 155)'</span><span class="p">);</span></code></pre></figure>

<p><img src="http://localhost:4000/img/PercentileRankingPost/decorators.svg" alt="Decorators" /></p>

<p>Much better. Now, the fun part. Let’s add our circles that indicate where a player ranks in relation to other players in the MLB. To do this, we’re going to need to do some more math for the label positioning, but we’re also going to need to make use of <code class="highlighter-rouge">d3.interpolateRdBu()</code>. The value that goes inside of this function (which just colors the circle) is going to be the inverse of what we <em>actually</em> want, so we’re going to subtract our real value from 1 to get the desired color. Note that we’re not actually putting the label on the circle yet, we’re just trying to figure out where the label would be positioned on the line so that we can color it appropriately:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">circles</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.ranks'</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">percentileData</span><span class="p">)</span>
                   <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                   <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'circle'</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'ranks'</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'cx'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cx</span> <span class="o">+</span> <span class="mi">10</span> <span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'cy'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cy</span> <span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'r'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">)</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">interpolateRdBu</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">cx</span><span class="o">/</span><span class="mi">150</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)))</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'stroke'</span><span class="p">,</span> <span class="s1">'black'</span><span class="p">);</span></code></pre></figure>

<p><img src="http://localhost:4000/img/PercentileRankingPost/circles.svg" alt="Circles" /></p>

<p>Look at that! It’s close, but we’re still missing labels. Both for the statistic we’re showing and for the actual percentile ranking number. Let’s do the labels for which statistic we’re showing first:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">statLabels</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.labels'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">percentileData</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'text'</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'labels'</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cy</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">label</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'font-family'</span><span class="p">,</span> <span class="s1">'sans-serif'</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'font-weight'</span><span class="p">,</span> <span class="s1">'bolder'</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'font-size'</span><span class="p">,</span> <span class="s1">'.6rem'</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span> <span class="s1">'black'</span><span class="p">);</span></code></pre></figure>

<p><img src="http://localhost:4000/img/PercentileRankingPost/statLabels.svg" alt="Stat Labels" /></p>

<p>This is looking really good. The last step (displaying the percentile ranking number) requires the use of another helper function. Because of the font sizing, we need to tweak our x values a bit before slapping them on our svg:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">getTextXValue</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">stringLength</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">x</span><span class="o">/</span><span class="mi">150</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span>
   <span class="k">switch</span> <span class="p">(</span><span class="nx">stringLength</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<p>At first it looks like hocus pocus, but you should be able to see why this is an important step. (hint: it’s due to the svg size being 170, percentiles ranging from 0-100, and the fact that the values may be 1 digit long, 2 digits long, or 3 digits long.)</p>

<p>Okay, let’s finally get our text labels up and running:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">text</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.percentRank'</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">percentileData</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
              <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'text'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'percentRank'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">getTextXValue</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">cx</span><span class="p">))</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">cy</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">cx</span><span class="o">/</span><span class="mi">150</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'font-weight'</span><span class="p">,</span> <span class="s1">'bolder'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'font-size'</span><span class="p">,</span> <span class="s1">'.7rem'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span> <span class="nx">d</span>  <span class="o">=&gt;</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">cx</span><span class="o">/</span><span class="mi">150</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">70</span> <span class="o">||</span>
                                       <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">cx</span><span class="o">/</span><span class="mi">150</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)</span>
                        <span class="p">?</span> <span class="s1">'white'</span> <span class="p">:</span> <span class="s1">'black'</span><span class="p">);</span></code></pre></figure>

<p><img src="http://localhost:4000/img/PercentileRankingPost/final.svg" alt="Final" /></p>

<p>Tada! The final product looks great, and it’s an easy way to visualize percentile data. I hope you’ve enjoyed this quick walkthrough. The full observable notebook is available here:
<a href="https://observablehq.com/@jakenherman/visualizing-percentile-data">https://observablehq.com/@jakenherman/visualizing-percentile-data</a>.</p>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Horizontal Display Unit Personal Site -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9580564349953922"
     data-ad-slot="1624547715"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </article>
</div>

<div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/articles/2020-12/visualizing-percentile-data-with-d3" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons -->


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jakenherman-com';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



        <footer>
  &copy; 2021 jaken herman. Powered by <a href="http://jekyllrb.com/">Jekyll</a>, <a href="http://github.com/renyuanz/leonids/">leonids theme</a> made with <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-134666359-1', 'auto');
  ga('send', 'pageview');
</script>



</body>
</html>
